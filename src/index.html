<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Brandon Mosher</title>
    <link rel="preconnect" href="https://raw.githubusercontent.com">
    <link rel="preconnect" href="https://api.github.com">
</head>

<body>
    <on-scroll query-selector-apply="nav-bar" scroll-up-start-remove-class="nav-bar-hide"
        scroll-up-stop-add-class="nav-bar-hide" scroll-down-start-add-class="nav-bar-hide"
        scroll-up-max-add-class="nav-bar-top" scroll-down-start-remove-class="nav-bar-top">
    </on-scroll>
    <nav-bar>
        <nav-entry href="#home">Home</nav-entry>
        <nav-entry href="#resume">Resume</nav-entry>
        <nav-entry href="#skills">Skills</nav-entry>
        <nav-entry href="#projects">Projects</nav-entry>
        <nav-entry href="#experience">Experience</nav-entry>
        <nav-entry href="#contact">Contact</nav-entry>
    </nav-bar>
    <on-scroll-container class="scroll-snap-container">
        <parallax-group scroll-parent="body">
            <parallax-layer id="parallax-layer-foreground">
                <nav-section id="home">
                    <div class="center-children scroll-snap-center">
                        <div id="intro-container">
                            <h1>I<span>'</span>M<br>Brandon<br>Mosher<span>.</span>
                            </h1>
                            <h2>Software Engineer</h2>
                        </div>
                    </div>
                </nav-section>

                <padding-section class="height-50"></padding-section>

                <nav-section id="resume">
                    <div class="horizontal-center-children scroll-snap-center">
                        <nav-section-header>
                            <h3><span>01</span> Resume</h3>
                        </nav-section-header>
                    </div>
                </nav-section>

                <padding-section class="height-50"></padding-section>

                <nav-section id="skills">
                    <div class="horizontal-center-children scroll-snap-center">
                        <nav-section-header>
                            <h3><span>02</span> Skills</h3>
                        </nav-section-header>
                    </div>
                </nav-section>

                <padding-section class="height-50"></padding-section>

                <nav-section id="projects">
                    <div class="horizontal-center-children scroll-snap-center">
                        <nav-section-header>
                            <h3><span>03</span> Projects</h3>
                        </nav-section-header>
                    </div>
                </nav-section>

                <padding-section class="height-50"></padding-section>

                <nav-section id="experience" threshold="0.3"
                    class="height-250">
                    <div class="horizontal-center-children scroll-snap-start">
                        <nav-section-header>
                            <h3><span>04</span> Experience</h3>
                        </nav-section-header>
                    </div>
                </nav-section>

                <padding-section class="height-75"></padding-section>

                <nav-section id="contact">
                    <div class="horizontal-center-children scroll-snap-start">
                        <nav-section-header>
                            <h3><span>05</span> Contact</h3>
                        </nav-section-header>
                        <form id="contact-form" name="contact-form" class="content-container">
                            <form-control type="text" id="name" name="name" title="Hi, what's your name?" required="*">
                                Name</form-control>

                            <form-control type="email" id="email" name="email" title="john.smith@example.com"
                                required="*">
                                Email
                            </form-control>

                            <form-control type="tel" id="phone" name="phone" title="(111) 111-1111"
                                pattern="\([0-9]{3}\) [0-9]{3}-[0-9]{4}" template="(___) ___-____"
                                template-placeholder="_" allowed="0123456789">Phone</form-control>

                            <form-control type="textarea" id="message" name="message" title="Say hello!" required="*">
                                Message
                            </form-control>

                            <form-control type="submit" id="submit" value="">Submit</form-control>
                        </form>
                        <div id="footer">
                            <a href="https://icons8.com">Icons from Icons8</a>
                            <a href="https://fonts.google.com/specimen/Roboto+Mono">Fonts from Google</a>
                        </div>
                    </div>
                </nav-section>
            </parallax-layer>

            <parallax-layer id="parallax-layer-background">
                <tinted-background id="background1"></tinted-background>
                <tinted-background id="background2"></tinted-background>
                <tinted-background id="background3"></tinted-background>
                <tinted-background id="background4"></tinted-background>
                <tinted-background id="background5"></tinted-background>
                <tinted-background id="background6"></tinted-background>
            </parallax-layer>

        </parallax-group>
    </on-scroll-container>
    <script>
        const resumeUrl = 'https://raw.githubusercontent.com/brandonmosher/resume/main/build/resume-website/resume-website.pdf';
        const resumeJsonUrl = 'https://raw.githubusercontent.com/brandonmosher/resume/main/build/resume-website/resume-website.json';
        const formSubmitUrl = 'https://lmzel5xwlf.execute-api.us-east-1.amazonaws.com/live';

        background: {
            window.addEventListener('load', () => {
                const b1 = document.querySelector('#background1');
                b1.style.setProperty('--background-image', 'var(--background1-image-url)');
                b1.style.setProperty('opacity', '1');
            });
        }

        form: {
            const form = document.querySelector('form');
            form.action = formSubmitUrl;
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                form.querySelectorAll('form-control:not([type=submit])').forEach((node, i, arr) => {
                    node.style.display = 'none';
                });
                document.querySelector('form-control[type=submit]').innerText = 'Thank You!';
            });
        }

        content: {
            const makeId = name => name.toLowerCase().replace(/(\+|\(|\))/g, '').replace(/,| /g, '-').replace(/-{2,}/g, '-')

            const resumeHTML = (cvparagraph) =>
                `<on-intersection-set-class id="resume-container" class="content-container" enter-any-add-class="transition-fade-in">
                    <p id="resume-summary-container">${cvparagraph}</p>
                    <div id="resume-download-container">
                        <a id="resume-download-button"
                            href="${resumeUrl}"
                            target="_blank" rel="noopener noreferrer" data-type="document">
                            <h4>Download Resume</h4>
                        </a>
                    </div>
                </on-intersection-set-class>`;

            const makeSkillId = (name) => `progress-bar-${makeId(name)}`;

            const skillsHTML = (cventries) => {
                const skillHTML = ({ name, proficiencyPercentage } = {}) =>
                    `<progress-bar-borderless id="${makeSkillId(name)}" proficiency-percentage="${proficiencyPercentage}"><h4>${name}</h4></progress-bar-borderless>`;
                return `<on-intersection-set-class threshold="0.75" id="intersection-skills" class="content-container"
                        query-selector="progress-bar-container" enter-any-add-class="ready">
                        <progress-bar-container>
                            ${cventries.reduce((innerHTML, cvskill) => innerHTML + skillHTML(cvskill), '')}
                        </progress-bar-container>
                    </on-intersection-set-class>`;
            }

            const skillsCSS = (cventries) => {
                const skillCSS = ({ i, name, proficiencyPercentage } = {}) =>
                    `progress-bar-container.ready #${makeSkillId(name)} {--bar-completed-percentage: ${parseInt(proficiencyPercentage)}; transition-delay: ${0.15 * i}s}`;
                return cventries.reduce((skillsCSS, cvskill, i) => skillsCSS + skillCSS({ i, ...cvskill }), '');
            }

            const projectsHTML = (cventries) => {
                const projectHTML = ({ url, name, cvparagraph, gitHubRepoName } = {}) => {
                    if (gitHubRepoName) {
                        const [repoOwner, repoName] = gitHubRepoName.split('/');
                        return `<git-repo repo-owner="${repoOwner}"" repo-name="${repoName}"></git-repo>`;
                    }
                    return `<project id="project-${makeId(name)}"><a href="${url}">${name}</a><div>${cvparagraph}</div></project>`
                }
                return `<on-intersection-set-class id="projects-container" class="content-container" query-selector="git-user,git-repo,project" enter-any-add-class="ready">
                            <git-user user-login="brandonmosher"></git-user>
                            ${cventries.reduce((projectsHTML, cvproject) => projectsHTML + projectHTML(cvproject), '')}
                        </on-intersection-set-class>`
            }

            const experiencesHTML = (cventries) => {
                const experienceHTML = ({ startDate, endDate, organization, jobTitle, cvitems } = {}) =>
                    `<on-intersection-set-class threshold="0.25" enter-bottom-add-class="bounce">
                        <vertical-timeline-entry>
                            <h4>${startDate} - ${endDate}</h4>
                            <hr>
                            <div>
                                <h5>${organization}</h5>
                                <h6>${jobTitle}</h6>
                                <br>
                                <p>${cvitems}</p>
                            </div>
                        </vertical-timeline-entry>
                    </on-intersection-set-class>`;
                return `<vertical-timeline>
                        ${cventries.reduce((experienceInnerHTML, cventry) =>
                    experienceInnerHTML + experienceHTML({ ...cventry, cvitems: cventry.cvitems.join(" ") }), '')}
                    </vertical-timeline>`;
            }

            fetch(resumeJsonUrl)
                .then(response => response.json())
                .then(json => {
                    css: {
                        const style = document.createElement('style');
                        style.innerHTML = skillsCSS(json.document.cv.skills.cventries);
                        document.head.appendChild(style);
                    }

                    html: {
                        document.querySelector('#resume > div').innerHTML += resumeHTML(json.document.cv.summary.cvparagraph);
                        document.querySelector('#skills > div').innerHTML += skillsHTML(json.document.cv.skills.cventries);;
                        document.querySelector('#projects > div').innerHTML += projectsHTML(json.document.cv.projects.cventries);
                        document.querySelector('#experience > div').innerHTML += experiencesHTML(json.document.cv.experience.cventries);
                    }

                    progressBar: {
                        const pbContainer = document.querySelector('progress-bar-container');

                        if (CSS.registerProperty) {
                            pbContainer.lastChild.addEventListener('transitionend', (e) => pbContainer.classList.add('done'));
                        }
                        else {
                            const intersectionSkills = document.querySelector('#intersection-skills');
                            const pbAnimate = () => {
                                function AnimateProgressBarFactory(bar, start, end, delta, delay) {
                                    const set = (value) => bar.style.setProperty('--bar-completed-percentage', value);
                                    return function animate() {
                                        if (start <= end) {
                                            if (delay) {
                                                --delay;
                                            }
                                            else {
                                                set(start);
                                                start += delta;
                                            }
                                            requestAnimationFrame(animate);
                                        }
                                        else {
                                            set(end);
                                        }
                                    }
                                }
                                Array.from(pbContainer.children).forEach((pb, i) =>
                                    AnimateProgressBarFactory(pb, 0, parseInt(pb.getAttribute('proficiency-percentage')), 3, 5 * (i + 1))());

                                intersectionSkills.removeEventListener('enterany', pbAnimate);
                            }

                            intersectionSkills.addEventListener('enterany', pbAnimate);
                        }

                        const resizeCallback = () => {
                            const ready = pbContainer.classList.contains('ready');
                            if (CSS.registerProperty) {
                                pbContainer.classList.remove('init');
                                pbContainer.classList.add('ready');
                                pbContainer.centerProgressBars();
                                pbContainer.classList.toggle('ready', ready);
                                pbContainer.classList.add('init');
                            }
                            else {
                                const pbs = Array.from(pbContainer.children);

                                if (!ready) {
                                    pbs.forEach(pb =>
                                        pb.style.setProperty('--bar-completed-percentage', pb.getAttribute('proficiency-percentage')));
                                }

                                pbContainer.centerProgressBars();

                                if (!ready) {
                                    pbs.forEach(pb =>
                                        pb.style.setProperty('--bar-completed-percentage', '0'));
                                }
                            }
                        }

                        resizeCallback();
                        let resizeTimer;
                        window.addEventListener('resize', (e) => {
                            clearTimeout(resizeTimer);
                            resizeTimer = setTimeout(resizeCallback, 50);
                        });
                    }
                });
        }
    </script>
</body>

</html>